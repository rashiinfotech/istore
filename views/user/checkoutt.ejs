<%- include("header.ejs") %>
<div class="cart-dropdown">
    <div class="cart-list">
        <% products.forEach(item => { %>
            <div class="product-widget">
                <div class="product-img">
                    <img src="<%= item.image_url %>" alt="">
                </div>
                <div class="product-body">
                    <h3 class="product-name"><a href="#"><%= item.product_name %></a></h3>
                    <h4 class="product-price"><span class="qty"><%= item.quantity %>x</span>$<%= item.price %></h4>
                </div>
                <button class="delete"><i class="fa fa-close"></i></button>
            </div>
        <% }); %>
    </div>
    <div class="cart-summary">
        <small><%= products.length %> Item(s) selected</small>
        <h5>SUBTOTAL: $<%= products.reduce((total, item) => total + (item.price * item.quantity), 0) %></h5>
    </div>
    <div class="cart-btns">
        <a href="#">View Cart</a>
        <a href="#">Checkout <i class="fa fa-arrow-circle-right"></i></a>
    </div>
</div>
<!-- /Cart -->

<!-- Menu Toogle -->
<div class="menu-toggle">
    <a href="#">
        <i class="fa fa-bars"></i>
        <span>Menu</span>
    </a>
</div>
<!-- /Menu Toogle -->
</div>
</div>
<!-- /ACCOUNT -->
</div>
<!-- row -->
</div>
<!-- container -->
</div>
<!-- /MAIN HEADER -->
</header>
<!-- /HEADER -->

<!-- NAVIGATION -->
<nav id="navigation">
    <!-- container -->
    <div class="container">
        <!-- responsive-nav -->
        <div id="responsive-nav">
            <!-- NAV -->
            <ul class="main-nav nav navbar-nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href='/'>Hot Deals</a></li>
                <li><a href="/store">Categories</a></li>
                <li><a href="/product">Laptops</a></li>
                <li><a href="/product">Smartphones</a></li>
                <li><a href="/product">Cameras</a></li>
                <li><a href="/product">Accessories</a></li>
            </ul>
            <!-- /NAV -->
        </div>
        <!-- /responsive-nav -->
    </div>
    <!-- /container -->
</nav>
<!-- /NAVIGATION -->

<!-- BREADCRUMB -->
<div id="breadcrumb" class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">
            <div class="col-md-12">
                <h3 class="breadcrumb-header">Checkout</h3>
                <ul class="breadcrumb-tree">
                    <li><a href="#">Home</a></li>
                    <li class="active">Checkout</li>
                </ul>
            </div>
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /BREADCRUMB -->

<!-- SECTION -->
<div class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">

            <div class="col-md-7">
                <!-- Billing Details -->
                <div class="billing-details">
                    <div class="section-title">
                        <h3 class="title">Billing address</h3>
                    </div>
                    <div class="form-group">
                        <input class="input" type="text" name="first-name" placeholder="First Name">
                    </div>
                    <div class="form-group">
                        <input class="input" type="text" name="last-name" placeholder="Last Name">
                    </div>
                    <div class="form-group">
                        <input class="input" type="email" name="email" placeholder="Email">
                    </div>
                    <div class="form-group">
                        <input class="input" type="text" name="address" placeholder="Address">
                    </div>
                    <div class="form-group">
                        <input class="input" type="text" name="city" placeholder="City">
                    </div>
                    <div class="form-group">
                        <input class="input" type="text" name="country" placeholder="Country">
                    </div>
                    <div class="form-group">
                        <input class="input" type="text" name="zip-code" placeholder="ZIP Code">
                    </div>
                    <div class="form-group">
                        <input class="input" type="tel" name="tel" placeholder="Telephone">
                    </div>
                    <div class="form-group">
                        <div class="input-checkbox">
                            <input type="checkbox" id="create-account">
                            <label for="create-account">
                                <span></span>
                                Create Account?
                            </label>
                            <div class="caption">
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt.</p>
                                <input class="input" type="password" name="password" placeholder="Enter Your Password">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Billing Details -->

                <!-- Shipping Details -->
                <div class="shipping-details">
                    <div class="section-title">
                        <h3 class="title">Shipping address</h3>
                    </div>
                    <div class="input-checkbox">
                        <input type="checkbox" id="shipping-address">
                        <label for="shipping-address">
                            <span></span>
                            Ship to a different address?
                        </label>
                        <div class="caption">
                            <div class="form-group">
                                <input class="input" type="text" name="first-name" placeholder="First Name">
                            </div>
                            <div class="form-group">
                                <input class="input" type="text" name="last-name" placeholder="Last Name">
                            </div>
                            <div class="form-group">
                                <input class="input" type="email" name="email" placeholder="Email">
                            </div>
                            <div class="form-group">
                                <input class="input" type="text" name="address" placeholder="Address">
                            </div>
                            <div class="form-group">
                                <input class="input" type="text" name="city" placeholder="City">
                            </div>
                            <div class="form-group">
                                <input class="input" type="text" name="country" placeholder="Country">
                            </div>
                            <div class="form-group">
                                <input class="input" type="text" name="zip-code" placeholder="ZIP Code">
                            </div>
                            <div class="form-group">
                                <input class="input" type="tel" name="tel" placeholder="Telephone">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Shipping Details -->

                <!-- Order notes -->
                <div class="order-notes">
                    <textarea class="input" placeholder="Order Notes"></textarea>
                </div>
                <!-- /Order notes -->
            </div>

            <!-- Order Details -->
            <div class="col-md-5 order-details">
                <div class="section-title text-center">
                    <h3 class="title">Your Order</h3>
                </div>
                <div class="order-summary">
                    <div class="order-col">
                        <div><strong>PRODUCT</strong></div>
                        <div><strong>TOTAL</strong></div>
                    </div>
                    <div class="order-products">
                        <% products.forEach(item => { %>
                            <div class="order-col">
                                <div><%= item.quantity %>x <%= item.product_name %></div>
                                <div>$<%= item.price %></div>
                            </div>
                        <% }); %>
                    </div>
                    <div class="order-col">
                        <div>Shipping</div>
                        <div><strong>FREE</strong></div>
                    </div>
                    <div class="order-col">
                        <div><strong>TOTAL</strong></div>
                        <div><strong class="order-total">$<%= products.reduce((total, item) => total + (item.price * item.quantity), 0) %></strong></div>
                    </div>
                </div>
                <div class="payment-method">
                    <div class="input-radio">
                        <input type="radio" name="payment" id="payment-1">
                        <label for="payment-1">
                            <span></span>
                            Direct Bank Transfer
                        </label>
                        <div class="caption">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                        </div>
                    </div>
                    <div class="input-radio">
                        <input type="radio" name="payment" id="payment-2">
                        <label for="payment-2">
                            <span></span>
                            Cheque Payment
                        </label>
                        <div class="caption">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                        </div>
                    </div>
                    <div class="input-radio">
                        <input type="radio" name="payment" id="payment-3">
                        <label for="payment-3">
                            <span></span>
                            Paypal System
                        </label>
                        <div class="caption">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                        </div>
                    </div>
                </div>
                <div class="input-checkbox">
                    <input type="checkbox" id="terms">
                    <label for="terms">
                        <span></span>
                        I've read and accept the <a href="#">terms & conditions</a>
                    </label>
                </div>
                <a href="#" class="primary-btn order-submit">Place order</a>
            </div>
            <!-- /Order Details -->
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /SECTION -->

<%- include("footer.ejs") %>


<script>


                    $('.change-address-btn').on('click', function() {
                        var addressType = $(this).data('address-type');
                        // Show the modal
                        $('#address-modal').show();

                        // Make an AJAX call to fetch addresses
                        $.ajax({
                            url: '/get-address',  // Replace with your endpoint to fetch addresses
                            method: 'POST',
                            success: function(response) {
                                console.log(response);  // Log the response for debugging
                                if (Array.isArray(response)) {
                                    var addressListHtml = '';
                                    response.forEach(function(address) {
                                        addressListHtml += `
                                            <div>
                                                <input type="radio" name="address" value="${address._id}" data-address='${JSON.stringify(address)}'> 
                                                <strong>${address.addressLine1}</strong>, ${address.street}, ${address.city}, ${address.state}, ${address.ZIP}, ${address.country}
                                            </div>
                                        `;
                                    });
                                    $('#address-list').html(addressListHtml);
                                    $('#address-modal').data('address-type', addressType);
                                } else {
                                    console.error("Expected an array but got:", response);
                                }
                            },
                            error: function(xhr, status, error) {
                                console.error("AJAX error:", status, error);
                            }
                        });
                    });

// Handle the click event of the "Select Address" button in the modal
$('#select-address-btn').on('click', function() {
    var selectedAddress = $('input[name="address"]:checked').data('address');
    if (selectedAddress) {
        var addressType = $('#address-modal').data('address-type');
        var addressHtml = `
            <p><strong>AddressLine1:</strong> ${selectedAddress.addressLine1}</p>
            <p><strong>Street:</strong> ${selectedAddress.street}</p>
            <p><strong>City:</strong> ${selectedAddress.city}</p>
            <p><strong>State:</strong> ${selectedAddress.state}</p>
            <p><strong>Pincode:</strong> ${selectedAddress.ZIP}</p>
            <p><strong>Country:</strong> ${selectedAddress.country}</p>
        `;
        setSelectedAddress(addressType, selectedAddress._id, addressHtml);
        // Hide the modal
        $('#address-modal').hide();
    } else {
        alert('Please select an address.');
    }
});
